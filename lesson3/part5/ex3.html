<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lesson3 part5 ex3</title>
</head>
<style>
    html,
    body {
        height: 100vh;
        width: 100vw;
        margin: 0;
        padding: 0;
    }

    svg {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        display: block;
        width: 100%;
        height: 100%;
    }

    –ê video {
        position: fixed;
        right: 0;
        bottom: 0;
        min-width: 100%;
        min-height: 100%;
    }
</style>

<body>
    <svg>
        <foreignObject x="0" y="0" width="100%" height="100%">
            <video id="vid1" autoplay="autoplay" muted="muted" preload="auto" loop="loop">
                <source src="portalInTimeVideo.mp4" type="video/mp4" />
            </video>
        </foreignObject>
    </svg>
    <svg>
        <defs>
            <clipPath id="mask">
                <circle id="mask-circle" cx="50%" cy="50%" r="15%" />
            </clipPath>
        </defs>
        <foreignObject clip-path="url(#mask)" x="0" y="0" width="100%" height="100%">
            <video id="vid2" autoplay="autoplay" muted="muted" preload="auto" loop="loop">
                <source src="portalInTimeVideo.mp4" type="video/mp4" />
            </video>
        </foreignObject>
        <g id="aimLines">
            <line x1="-2400" y1="0" x2="2400" y2="0" stroke="white" stroke-width=2 />
            <line x1="0" y1="-1800" x2="0" y2="1800" stroke="white" stroke-width=2 />
        </g>
        <circle id="aimCircle1" cx="50%" cy="50%" r="15.5%" fill="none" stroke="white" stroke-width="2"
            stroke-dasharray="42 10" />
        <circle id="aimCircle2" cx="50%" cy="50%" r="16.5%" fill="none" stroke="white" stroke-width="4"
            stroke-dasharray="42 10" />
    </svg>
    <script>
        const aimLn = document.getElementById("aimLines");
        const aimC1 = document.getElementById("aimCircle1");
        const aimC2 = document.getElementById("aimCircle2");
        const portal = document.getElementById("mask-circle");

        let portalRadius = parseInt(/(\d*)/g.exec(portal.getAttribute("r")));
        let previousXposition = 0;
        let aimRotate1 = 0;
        let aimRotate2 = 0;
        let jumpFlag = 0;

        document.getElementById('vid1').addEventListener('loadedmetadata', () => {
            this.currentTime = 127;
            this.play();
        }, false)

        window.addEventListener('mousemove', e => {
            portal.setAttribute("cx", e.pageX);
            portal.setAttribute("cy", e.pageY);

            aimLn.setAttribute("transform", "translate(" + e.pageX + " " + e.pageY + ")");

            if (previousXposition < e.pageX) {
                aimRotate1++;
                aimRotate2--;
            }
            else {
                aimRotate1--;
                aimRotate2++;
            }

            aimC1.setAttribute("cx", e.pageX); aimC1.setAttribute("cy", e.pageY);
            aimC1.setAttribute("transform", "rotate(" + aimRotate1 + " " + e.pageX + " " + e.pageY + ")");

            aimC2.setAttribute("cx", e.pageX); aimC2.setAttribute("cy", e.pageY);
            aimC2.setAttribute("transform", "rotate(" + aimRotate2 + " " + e.pageX + " " + e.pageY + ")");

            previousXposition = e.pageX;
        }, false)

        let portalJump = () => {
            portalRadius++;
            portal.setAttribute("r", portalRadius + "%");
            if (portalRadius < 100) {
                setTimeout(portalJump);
            }
        }

        let portalBackJump = () => {
            portalRadius--;
            portal.setAttribute("r", portalRadius + "%");
            if (portalRadius > 15) {
                setTimeout(portalBackJump, 1);
            }
        }

        document.onclick = e => {
            if (jumpFlag == 0) {
                portalJump();
                jumpFlag = 1;
            } else {
                portalBackJump();
                jumpFlag = 0;
            }
        }
    </script>
</body>